<!doctype html>
<html lang="pt-br">
<head>
<meta charset="utf-8">
<title>SaÃºde Plena â€” Camadas Territoriais</title>
<meta name="viewport" content="width=device-width,initial-scale=1">

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<style>
html,body{height:100%;margin:0;font-family:system-ui}
#map{height:100vh;width:100vw}
.leaflet-tooltip{
  background:#020617;color:#fff;
  border:1px solid rgba(255,255,255,.15);
  border-radius:6px;font-size:13px;
}
</style>
</head>

<body>
<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>

/* ================= MAPA BASE ================= */
const map = L.map("map").setView([-14,-54],4);

L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{
  attribution:"Â© OpenStreetMap"
}).addTo(map);

/* ================= URLs ================= */
const URL_ESTADOS =
  "https://raw.githubusercontent.com/giuliano-macedo/geodata-br-states/main/geojson/br_states.json";

const URL_MUNICIPIOS =
  "https://raw.githubusercontent.com/tbrugz/geodata-br/master/geojson/geojs-100-mun.json";

const URL_BIOMAS =
  "https://sisdia.df.gov.br/server/rest/services/Hosted/biomas_brasileiros/FeatureServer/1/query" +
  "?where=1%3D1&outFields=*&returnGeometry=true&outSR=4326&f=geojson";

const URL_BACIAS =
  "https://www.snirh.gov.br/arcgis/rest/services/Divisoes_bacias_hidrograficas/FeatureServer/1/query" +
  "?where=1%3D1&outFields=*&returnGeometry=true&outSR=4326&f=geojson";

/* ================= ESTILOS ================= */
const estilos = {
  estados: {color:"#2563eb", weight:1.5, fillOpacity:0.15},
  municipios:{color:"#16a34a", weight:0.8, fillOpacity:0.08},
  biomas:{color:"#22c55e", weight:1.2, fillOpacity:0.05},
  bacias:{color:"#0284c7", weight:1.2, fillOpacity:0.05}
};

/* ================= CAMADAS ================= */
let layerEstados, layerMunicipios, layerBiomas, layerBacias;

/* ================= LOAD ================= */
async function iniciar(){

  /* ESTADOS */
  const estados = await fetch(URL_ESTADOS).then(r=>r.json());
  layerEstados = L.geoJSON(estados,{
    style: estilos.estados,
    onEachFeature:(f,l)=>{
      l.bindTooltip(`${f.properties.name} (${f.properties.state_code})`);
    }
  });

  /* MUNICÃPIOS (Brasil inteiro) */
  const municipios = await fetch(URL_MUNICIPIOS).then(r=>r.json());
  layerMunicipios = L.geoJSON(municipios,{
    style: estilos.municipios,
    onEachFeature:(f,l)=>{
      l.bindTooltip(f.properties.name || "MunicÃ­pio");
    }
  });

  /* BIOMAS */
  const biomas = await fetch(URL_BIOMAS).then(r=>r.json());
  layerBiomas = L.geoJSON(biomas,{
    style: estilos.biomas,
    onEachFeature:(f,l)=>{
      const nome = f.properties.BIOMA || f.properties.Bioma || "Bioma";
      l.bindTooltip(nome);
    }
  });

  /* BACIAS */
  const bacias = await fetch(URL_BACIAS).then(r=>r.json());
  layerBacias = L.geoJSON(bacias,{
    style: estilos.bacias,
    onEachFeature:(f,l)=>{
      const nome = f.properties.NM_MESO || f.properties.NOME || "Bacia";
      l.bindTooltip(nome);
    }
  });

  /* CONTROLE DE CAMADAS */
  L.control.layers(
    null,
    {
      "ðŸŸ¦ Estados": layerEstados,
      "ðŸŸ© MunicÃ­pios": layerMunicipios,
      "ðŸŒ¿ Biomas": layerBiomas,
      "ðŸ’§ Bacias HidrogrÃ¡ficas": layerBacias
    },
    {collapsed:false}
  ).addTo(map);

  /* Liga sÃ³ estados por padrÃ£o */
  layerEstados.addTo(map);
}

iniciar();

</script>
</body>
</html>
