<!doctype html>
<html lang="pt-br">
<head>
<meta charset="utf-8">
<title>Painel de Doenças — Brasil</title>
<meta name="viewport" content="width=device-width,initial-scale=1">

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<style>
html,body{height:100%;margin:0;font-family:system-ui;background:#0b1220;color:#eaefff}
#app{display:flex;height:100%}
#map{flex:1}

#painel{
  width:360px;
  background:#0f172a;
  border-left:1px solid rgba(255,255,255,.1);
  padding:16px;
  transform:translateX(100%);
  transition:.3s;
  overflow-y:auto;
}
#painel.aberto{transform:translateX(0)}
#painel h2{margin:0 0 6px;font-size:18px}
#painel .sub{opacity:.7;font-size:13px;margin-bottom:12px}
.card{
  background:#111827;
  border:1px solid rgba(255,255,255,.08);
  border-radius:10px;
  padding:10px;
  margin-bottom:10px;
}
.vazio{opacity:.6;font-style:italic}

.leaflet-control-layers{
  background:#020617!important;
  color:#fff!important;
  border-radius:10px!important;
}
</style>
</head>

<body>
<div id="app">
  <div id="map"></div>

  <div id="painel">
    <h2 id="titulo">Seleção</h2>
    <div class="sub" id="subtitulo">Clique no mapa</div>
    <div id="conteudo" class="vazio">
      Nenhum dado carregado ainda.
    </div>
  </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
const map = L.map('map').setView([-14,-54],4);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
  attribution:'© OpenStreetMap'
}).addTo(map);

const painel = document.getElementById("painel");
const titulo = document.getElementById("titulo");
const subtitulo = document.getElementById("subtitulo");
const conteudo = document.getElementById("conteudo");

/* ========= PAINEL ========= */
function abrirPainel(nivel, codigo, nome){
  painel.classList.add("aberto");
  titulo.innerText = nome;
  subtitulo.innerText = `Nível: ${nivel} • Código: ${codigo}`;
  conteudo.innerHTML = `
    <div class="card">
      <strong>Status</strong><br>
      Painel pronto. Dados entram depois.
    </div>
    <div class="card">
      <strong>Futuro aqui:</strong>
      <ul>
        <li>Casos</li>
        <li>Óbitos</li>
        <li>Incidência</li>
        <li>Gráficos</li>
      </ul>
    </div>
  `;
}

/* ========= ESTILO ========= */
function estilo(cor){
  return {
    weight:1.2,
    color:cor,
    fillColor:cor,
    fillOpacity:.15
  };
}

/* ========= CLICK ========= */
function bindClick(layer, nivel){
  layer.on({
    click:e=>{
      const p = e.target.feature.properties || {};
      const nome = p.nome || p.NM_UF || p.NM_MUN || p.NM_REGIAO || "Sem nome";
      const codigo =
        p.sigla || p.SIGLA_UF ||
        p.codigo || p.CD_MUN ||
        p.regiao || p.CD_REGIAO ||
        "—";
      abrirPainel(nivel, codigo, nome);
      map.fitBounds(e.target.getBounds(),{padding:[20,20]});
    }
  });
}

/* ========= CAMADAS ========= */
async function carregar(url, nivel, cor){
  const g = await fetch(url).then(r=>r.json());
  const layer = L.geoJSON(g,{
    style:()=>estilo(cor),
    onEachFeature:(f,l)=>bindClick(l,nivel)
  });
  return layer;
}

(async()=>{
  const regioes = await carregar("data/regioes.geojson","Região","#a78bfa");
  const estados  = await carregar("data/estados.geojson","Estado","#60a5fa");

  regioes.addTo(map);

  const overlays = {
    "Regiões":regioes,
    "Estados":estados
  };

  // municípios opcional
  try{
    const municipios = await carregar("data/municipios.geojson","Município","#34d399");
    overlays["Municípios"] = municipios;
  }catch(e){}

  L.control.layers(null,overlays,{collapsed:false}).addTo(map);
})();
</script>
</body>
</html>
